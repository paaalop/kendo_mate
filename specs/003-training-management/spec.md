# 기능 명세서: 수련 관리 (Training Management)

**기능 브랜치**: `003-training-management`  
**작성일**: 2026-01-31  
**상태**: 초안 (Draft)  
**입력**: PRD 명세 및 사용자 요구사항 (시간표별 조회, 관원 카드 UI, 원터치 출석, 진도 심사, 권한 제어 등)

## 사용자 시나리오 및 테스트

### 사용자 스토리 1 - 일일 출석 체크 (우선순위: P1)
1. **상황**: 관장님이 수련 관리 화면에 접속한다.
2. **동작**: 상단의 '5시부' 탭을 클릭하고, 특정 관원의 [출석] 버튼을 누른다.
3. **결과**: 버튼이 즉시 '출석완료' 상태로 변경되며(Optimistic UI), 상단의 오늘 출석 통계 숫자가 1 증가한다. 다시 누르면 출석 기록이 삭제되고 상태가 복구된다.

### 사용자 스토리 2 - 진도 관리 (우선순위: P1)
1. **상황**: 사범님이 수련 중인 관원의 기술 습득을 확인한다.
2. **동작**: 관원 카드의 [기술 통과] 버튼을 클릭한다.
3. **결과**: 현재 기술이 완료 처리되고, 즉시 다음 순서의 기술명이 카드에 표시된다. 성공 토스트 메시지가 나타난다.

## 질의응답 (Clarifications)

- **시간표 정렬**: 시간순 정렬 (예: 05:00, 14:00, 18:00).
- **승급 심사 알림**: '심사 관리' 섹션에서 월을 선택해 전송하며, `notices` 테이블에 자동 게시됨.
- **검색 범위**: 이름 또는 전화번호 뒷자리로 전체 관원 검색 가능.
- **활성 관원 기준**: 도장에 등록된 전체 관원 중 `status = 'active'`인 인원.
- **미납 표시**: '미납' 배지 클릭 시 개월 수만 표시 (금액은 숨김).
- **실수 방지**: 출석 및 기술 통과 모두 토글(Toggle) 방식으로 취소 가능.

## 요구사항 (Requirements)

### 기능적 요구사항 (Functional Requirements)

- **FR-001**: 시스템은 관원을 `default_session_time` 기준으로 그룹화하여 탭 또는 필터 UI로 제공해야 한다. 정렬 순서는 시간순, 급수순(내림차순), 이름순(오름차순)이다.
- **FR-002**: 관원 카드는 이름, 급수(`rank_name`), 현재 기술(미완료 항목 중 순서가 가장 낮은 것), 출석 버튼, 통과 버튼, '미납' 배지를 포함해야 한다.
- **FR-003**: 이름이나 전화번호로 전체 관원을 검색할 수 있는 검색바를 제공해야 한다.
- **FR-004**: [출석] 버튼 클릭 시 `attendance_logs`에 기록을 추가한다.
- **FR-005**: 당일 중복 출석을 방지하되, 버튼 재클릭 시 기록을 삭제(Toggle)할 수 있어야 한다.
- **FR-006**: 출석 체크 시 서버 응답 전 UI를 즉시 업데이트하는 Optimistic UI를 적용해야 한다. 실패 시 원래 상태로 복구하고 에러 토스트를 표시한다.
- **FR-007**: [기술 통과] 버튼 클릭 시 `user_progress`에 완료 기록을 생성하고, 즉시 다음 순서의 기술을 화면에 표시한다.
- **FR-008**: 기술 통과 취소 시 완료 기록을 삭제하고 UI를 이전 기술 상태로 복구한다.
- **FR-009**: 승급(Rank Promotion)은 모든 기술 통과 후에도 관장님이 별도로 처리하는 수동 프로세스를 유지한다.
- **FR-010**: `owner` 또는 `instructor` 역할(Role)을 가진 사용자만 이 기능에 접근할 수 있다.
- **FR-011**: 사범님에게는 구체적인 미납 금액을 숨기고 '미납' 상태만 노출한다.
- **FR-012**: '미납' 배지 클릭 시 상세 내역 대신 미납 개월 수(예: "2개월 미납")를 표시한다.
- **FR-013**: 화면 상단에 '승급 심사 관리' 섹션을 제공한다. 심사 월을 선택하고 [알림 전송] 클릭 시 아래 템플릿으로 공지사항을 자동 생성한다.
    - **제목**: `[공지] {month}월 승급 심사 일정 안내`
    - **본문**: `{month}월 승급 심사가 진행될 예정입니다. 수련생 여러분은 준비에 만전을 기해 주시기 바랍니다.`
- **FR-014**: 화면 상단에 오늘 출석 통계(예: "오늘 출석: 12/45")를 표시한다. 분모는 도장의 전체 활성 관원(`status = 'active'`) 수이다.

### 주요 엔티티 (Key Entities)

- **Profile**: 관원의 이름, 급수, 기본 수련 시간 등 정보.
- **Attendance Log**: 일별 출석 기록.
- **Curriculum Item**: 도장별 정의된 기술/커리큘럼 항목.
- **User Progress**: 관원별 기술 통과 기록.

## 예외 케이스 (Edge Cases)

- **수련 시간 미지정**: `default_session_time`이 없는 관원은 '기타' 또는 '미배정' 탭에 표시한다.
- **커리큘럼 완료**: 해당 급수의 모든 기술을 통과한 경우 '커리큘럼 완료' 또는 '심사 대기' 상태를 표시한다.
- **네트워크 오류**: Optimistic UI 업데이트 후 서버 요청 실패 시, UI를 이전 상태로 롤백하고 사용자에게 알림을 제공한다.
- **중복 클릭**: 단시간 내 여러 번 클릭 시 프론트엔드에서 중복 제출을 방지한다.

## 성공 지표 (Success Criteria)

- **SC-001**: 관장님이 20명의 출석 체크를 30초 이내에 완료할 수 있다.
- **SC-002**: 생성된 모든 출석 기록이 정확한 날짜와 관원 ID를 가진다.
- **SC-003**: 일반 관원은 관리 페이지 접근이 100% 차단된다.
- **SC-004**: 출석 버튼 클릭 후 100ms 이내에 UI 상태가 변경된다.
