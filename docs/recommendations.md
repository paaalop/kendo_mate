# AI Agent Specification Prompts based on PRD

이 문서는 `docs/PRD.md`에 정의된 검도장 관리 서비스(MVP)의 기능을 구현하기 위해, AI Agent에게 상세 명세(Specification) 작성을 지시할 때 사용할 프롬프트들을 정리한 파일입니다.

각 섹션은 특정 기능군을 담당하며, 이를 복사하여 AI Agent에게 "이 기능을 위한 상세 구현 스펙(사용자 스토리, 예외 처리, 데이터 흐름, UI/UX 디테일 포함)을 작성해줘"라고 요청할 수 있도록 구성되었습니다.

---

## 1. 데이터베이스 및 기본 인프라 구축 (Database & Infra)

**목표:** Supabase를 이용한 테넌트(도장), 사용자(프로필), 권한(RLS) 기본 구조 설계.

**Prompt:**
```markdown
@docs/PRD.md 의 "2. 데이터베이스 스키마" 섹션을 바탕으로 Supabase 데이터베이스 및 기본 인증 구조에 대한 상세 기술 명세서를 작성해 주세요.

**포함해야 할 내용:**
1.  **테이블 설계:** `dojos`, `profiles`, `signup_requests`, `curriculum_items`, `user_progress`, `attendance_logs`, `payments`, `notices`, `posts`, `comments` 테이블의 컬럼, 데이터 타입, 관계(FK), 제약조건(Constraints)을 명확히 정의하세요.
2.  **RLS (Row Level Security) 정책:** MVP 단계에서는 `true`로 모두 허용하지만, 향후 보안을 고려하여 '관장(owner)만 수정 가능', '본인 데이터만 조회 가능' 등의 주석이나 향후 적용할 정책 가이드를 포함하세요.
3.  **데이터 정제 (Sanitization) 로직:** `profiles` 테이블의 `phone`, `guardian_phone` 컬럼 저장 시 하이픈을 제거하는 Trigger 또는 Application Level 로직을 명시하세요.
4.  **역할(Role) 정의:** `profiles.role` ENUM ('owner', 'instructor', 'member')의 의미와 각 역할이 데이터베이스 레벨에서 가져야 할 기본적인 권한 범위를 설명하세요.
5.  **초기 데이터 시딩 (Seeding):** 테스트를 위한 기본 커리큘럼 데이터와 관리자 계정 생성 시나리오를 포함하세요.
```

---

## 2. 회원가입 및 온보딩 프로세스 (Auth & Onboarding)

**목표:** 관장님(도장 생성)과 관원/사범(가입 신청 및 승인)의 서로 다른 가입 흐름 구현.

**Prompt:**
```markdown
@docs/PRD.md 의 "3. 핵심 기능 상세 명세 - B. 사범님 등록 프로세스" 및 "4. 화면 구성 - [가입 Flow]" 섹션을 바탕으로 회원가입 및 온보딩 기능 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **관장 가입 Flow:**
    *   계정 생성(이메일/비번) -> 도장(Tenant) 정보 입력(이름) -> `dojos` 테이블 생성 -> 본인 `profiles` 생성 및 `role='owner'` 자동 할당 -> 메인 대시보드 진입.
2.  **관원/사범 가입 Flow:**
    *   계정 생성 -> 도장 검색(이름 검색) -> 가입 신청 폼 작성(본인 이름, 전화번호, 성인 여부, (미성년자일 경우) 보호자 전화번호) -> `signup_requests` 테이블에 `status='pending'`으로 저장 -> '승인 대기 중' 화면 출력.
3.  **사범 등록 특이사항:** 별도의 사범 가입 페이지 없음. 관원으로 가입 후 관장이 승인 및 역할 변경을 통해 사범으로 지정하는 프로세스를 명확히 기술하세요.
4.  **전화번호 입력 UX:** 사용자가 `010-1234-5678`로 입력하더라도 백엔드 전송 시 `01012345678`로 변환되는 로직을 UI 단에서 처리하도록 명세하세요.
```

---

## 3. 관리자(관장/사범) - 수련 및 출석 관리 (Training Management)

**목표:** 도장의 핵심 업무인 출석 체크와 진도 관리를 빠르고 직관적으로 처리.

**Prompt:**
```markdown
@docs/PRD.md 의 "3. 핵심 기능 상세 명세 - C. 출석 체크 로직" 및 "[관리자 앱] 탭 1: 수련 관리"를 바탕으로 수련 관리 기능 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **시간표별 조회 UI:** `profiles.default_session_time`을 기준으로 탭(Tab)이나 필터로 관원 리스트를 분류하여 보여주는 UI 구조를 설계하세요 (예: 5시부, 6시부).
2.  **관원 카드 UI:** 각 관원 카드에 이름, 현재 급수(`rank_name`), 현재 배우는 기술(`curriculum`), 출석 버튼, 심사(Pass) 버튼을 배치하세요.
3.  **원터치 출석 체크:**
    *   [출석] 버튼 클릭 시 `attendance_logs` INSERT.
    *   당일 이미 출석한 경우 버튼 비활성화 또는 '출석완료' 상태 표시 (중복 방지).
    *   Optimistic UI 적용 (서버 응답 전 즉시 UI 반영) 고려.
4.  **진도 심사(Pass):**
    *   [기술 통과] 버튼 클릭 시 현재 단계 `user_progress` 상태 완료 처리 -> 다음 커리큘럼 아이템 자동 배정(또는 다음 단계 활성화) 로직.
5.  **권한 체크:** 이 기능은 `owner`와 `instructor` role을 가진 사용자만 접근 가능해야 합니다.
```

---

## 4. 관리자(관장/사범) - 회원 및 역할 관리 (Member Management)

**목표:** 가입 요청 승인, 회원 정보 조회, 그리고 '사범 임명' 기능 구현.

**Prompt:**
```markdown
@docs/PRD.md 의 "3. 핵심 기능 상세 명세 - A, B" 및 "[관리자 앱] 탭 2: 회원 관리"를 바탕으로 회원 관리 기능 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **가입 요청 관리 (Approval Queue):**
    *   `signup_requests` 테이블에서 `status='pending'`인 목록 조회.
    *   [승인] 클릭 시: `profiles` 테이블에 레코드 생성(Insert) -> `signup_requests` 상태 'approved' 업데이트.
    *   [반려] 클릭 시: `signup_requests` 상태 'rejected' 업데이트.
2.  **전체 관원 목록 및 검색:** 이름 또는 전화번호 뒷자리로 관원을 검색하는 기능.
3.  **관원 상세 정보:** 관원의 기본 정보, 보호자 정보, 현재 급수, 누적 출석일수 조회.
4.  **역할 변경 (Role Promotion) - *Critical*:**
    *   **권한:** 오직 `owner`만이 다른 사용자의 역할을 변경할 수 있음.
    *   기능: 특정 회원의 상세 페이지에서 역할을 `member` -> `instructor`로 변경하는 드롭다운 또는 버튼 제공.
    *   UI: 사범 로그인 시 이 기능(역할 변경)이 노출되지 않도록 처리하는 조건부 렌더링 로직 명세.
```

---

## 5. 관리자(관장 전용) - 회비 및 도장 관리 (Admin Only Features)

**목표:** 민감한 정보인 수납 관리와 도장 설정은 관장님만 접근 가능하도록 격리.

**Prompt:**
```markdown
@docs/PRD.md 의 "3. 핵심 기능 상세 명세 - A. 역할별 권한 매트릭스" 및 "[관리자 앱] 탭 4: 설정" 중 관장 전용 기능을 바탕으로 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **권한 격리:** `payments` 테이블 조회 및 도장 정보 수정 API는 반드시 `role='owner'` 체크를 통과해야 함을 명시하세요. 사범 계정에서는 해당 UI 메뉴 자체가 숨김(Hidden) 처리되어야 합니다.
2.  **회비 관리 (Payments):**
    *   월별 수납 현황 리스트 (대상자 전체 조회).
    *   상태 필터: 미납(Unpaid) / 확인요청(Pending) / 납부완료(Paid).
    *   액션: 관장님이 수동으로 '납부완료' 처리하는 기능.
3.  **도장 정보 수정:** 도장 이름, 수련 시간표(세션) 설정 기능.
4.  **커리큘럼 관리:** `curriculum_items` 추가/수정/순서 변경 기능.
```

---

## 6. 사용자(관원/학부모) - 홈 및 가족 연동 (User Home & Family)

**목표:** 학부모가 자녀의 성장을 확인하고 안심할 수 있는 데이터 시각화 및 다자녀 전환.

**Prompt:**
```markdown
@docs/PRD.md 의 "3. 핵심 기능 상세 명세 - D. 다자녀 연결" 및 "[관원 앱] 탭 1: 내 진도"를 바탕으로 사용자 홈 화면 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **가족 계정 연동 (Family Linking):**
    *   로그인한 유저가 성인(`is_adult=true`)일 때, `guardian_phone`이 본인 전화번호와 일치하는 `profiles`를 모두 조회.
    *   **자녀 선택 UI:** 메인 화면 상단에 본인+자녀 프로필 이미지를 가로 스크롤(Avatar Group) 형태로 배치하여 탭 한 번으로 데이터 컨텍스트(Context)를 전환하는 UX.
2.  **대시보드 데이터 시각화:**
    *   **출석:** "이번 달 N번 출석했어요" 문구 및 달력/히트맵 형태의 시각화.
    *   **진도:** 현재 급수(`rank_name`)와 배우고 있는 기술(`curriculum_items.title`) 표시. 진행률(%) 바(Bar) 그래프.
```

---

## 7. 커뮤니티 (Community)

**목표:** 공지사항 전달 및 관원 간 소통 활성화.

**Prompt:**
```markdown
@docs/PRD.md 의 "[관리자 앱] 탭 3: 커뮤니티" 및 "[관원 앱] 탭 2: 커뮤니티"를 바탕으로 커뮤니티 기능 명세서를 작성해 주세요.

**상세 요구사항:**
1.  **게시판 카테고리:**
    *   **공지사항(Notices):** `notices` 테이블 사용. 작성(관장/사범), 조회(전체). 상단 고정(Pin) 기능 포함.
    *   **자유게시판(Posts):** `posts` 테이블 사용. 카테고리(자유/질문/운동인증). 작성/조회/댓글(전체).
2.  **이미지 업로드:** 게시글 작성 시 사진 첨부 기능 (Supabase Storage 활용 또는 Base64 임시 처리 명시).
3.  **댓글(Comments) 시스템:** 게시글 상세 화면 하단 댓글 목록 및 작성 인풋.
4.  **Moderation (삭제 권한):**
    *   작성자 본인: 자신의 글/댓글 삭제 가능.
    *   관리자(관장/사범): 모든 글/댓글 삭제 가능 (부적절한 콘텐츠 관리).
```

## 8. 관원 일괄 등록 및 부모 연동 (Excel Upload & Parent Linking)

**목표:** 엑셀 업로드를 통한 관원 데이터 일괄 생성(Pre-create)과 부모 가입 시 전화번호 기반 자동 연동(Post-link) 구현.

**Prompt:**
```markdown
이전의 '가상 프로필(Shadow Profile)' 방식을 폐기하고, "선(先) 생성, 후(後) 연동" 모델을 기반으로 관원 관리 및 부모 연결 기능을 구현하기 위한 상세 명세를 작성해 주세요.

**핵심 철학:**
1.  **Single Source of Truth:** 데이터의 원천은 도장(Admin)이 생성한 `profiles` 레코드입니다. 부모는 데이터를 생성하지 않고, 이미 존재하는 데이터에 대한 권한(Link)만 가져갑니다.
2.  **No Merge Logic:** 복잡한 데이터 병합(Merge) 로직을 제거하고, 단순 `UPDATE`(권한 부여) 만으로 연결을 처리합니다.

**상세 요구사항:**
1.  **관원 일괄 등록 (Excel Upload):**
    *   **기능:** 관리자(Owner)가 관원 명부 엑셀 파일(이름, 부모 전화번호 필수)을 업로드.
    *   **처리:** `profiles` 테이블에 관원 데이터를 일괄 INSERT. 이때 `guardian_id`는 `NULL`로 설정.
    *   **제약:** 부모가 아직 가입하지 않았더라도 관원 데이터는 정상적으로 생성되고 관리(출석 등)되어야 함.

2.  **부모-자녀 자동 매칭 (Auto-Discovery):**
    *   **Trigger:** 부모 계정 가입 또는 로그인 직후(대시보드 진입 시).
    *   **Logic:** `profiles.guardian_phone`이 부모의 인증된 전화번호와 일치하고, `guardian_id`가 `NULL`인 레코드를 조회 (`find_my_children_by_phone` RPC 활용).
    *   **UX:** "회원님의 자녀로 추정되는 [홍길동] 학생이 있습니다. 연결하시겠습니까?" 팝업 -> [연결] 클릭 시 `guardian_id` 업데이트.

3.  **데이터베이스 스키마 조정:**
    *   `profiles` 테이블에서 `is_shadow` 컬럼 제거 (또는 Deprecated).
    *   `guardian_id` (UUID, Nullable, FK to auth.users): 연결된 부모 ID.
    *   `guardian_phone` (Text): 매칭을 위한 식별자.

4.  **수동 연결 요청 (Fallback):**
    *   전화번호가 불일치하여 자동 매칭 실패 시, 부모가 이름/도장으로 검색하여 연결 요청(`link_requests`)을 보내는 흐름 포함.
```